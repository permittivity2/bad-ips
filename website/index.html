<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALPHA VERSION -- Bad IPs - Distributed IP Blocking System</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
        }
        .container { max-width: 1000px; margin: 0 auto; padding: 20px; }
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 60px 20px;
            text-align: center;
            margin-bottom: 40px;
            border-radius: 0 0 20px 20px;
        }
        header h1 { font-size: 3em; margin-bottom: 10px; }
        .card {
            background: white;
            padding: 30px;
            margin-bottom: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h2 {
            color: #667eea;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }
        h3 { color: #764ba2; margin: 25px 0 15px 0; }
        .install-box {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            margin: 20px 0;
            position: relative;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .install-command {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }
        .copy-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            white-space: nowrap;
            transition: background 0.3s;
        }
        .copy-btn:hover {
            background: #764ba2;
        }
        .copy-btn.copied {
            background: #10b981;
        }
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .feature {
            padding: 15px;
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            border-radius: 5px;
        }
        .alert {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-left: 5px solid #ffc107;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .alert.info { background: #d1ecf1; border-color: #0c5460; }
        ul { margin: 15px 0 15px 30px; }
        li { margin: 8px 0; }
        a { color: #667eea; text-decoration: none; }
        a:hover { text-decoration: underline; }
        .nav {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .nav a { margin-right: 20px; font-weight: 500; }
        footer { text-align: center; padding: 40px 20px; color: #666; }
    </style>
</head>
<body>
    <header>
        <h1>üõ°Ô∏è Bad IPs</h1>
        <p style="font-size:1.2em;opacity:0.9">v0.0.3 - Distributed IP Blocking System</p>
        <p>Real-time threat detection with centralized database</p>
        <p style="background: #ff6b6b; color: white; padding: 10px; border-radius: 5px; font-weight: bold;">‚ö†Ô∏è ALPHA SOFTWARE - Currently in testing on live production servers. Use with appropriate caution and testing in your environment.</p>
    </header>

    <div class="container">
        <nav class="nav">
            <a href="#quickstart">Quick Start</a>
            <a href="#install">Installation</a>
            <a href="#remove">Remove</a>
            <a href="#features">Features</a>
            <a href="#config">Configuration</a>
            <a href="configuration.html">Config Reference</a>
            <a href="#support">Support</a>
        </nav>

        <div class="card" id="quickstart">
            <h2>üöÄ Quick Start</h2>
            <p>Install Bad IPs on Ubuntu/Debian with a single command:</p>
            <div class="install-box">
                <div class="install-command">
                    <span>bash &lt;(curl -fsSL https://projects.thedude.vip/bad-ips/install.sh)</span>
                    <button class="copy-btn" onclick="copyInstallCommand(this)">üìã Copy</button>
                </div>
            </div>
            <p>The installer will:</p>
            <ul>
                <li>Add the Silver Linings apt repository</li>
                <li>Install Bad IPs and dependencies</li>
                <li>Configure PostgreSQL database connection</li>
                <li>Set up detectors for your services</li>
                <li>Configure trusted networks (never_block)</li>
                <li>Configure permanent blocks (always_block)</li>
                <li>Start monitoring automatically</li>
            </ul>
        </div>

        <div class="card" id="install">
            <h2>üì¶ Installation Steps</h2>
            <p>For those who prefer a step-by-step approach or want to understand what the installer does:</p>

            <h3>1. Add Repository and Install Package</h3>
            <div class="install-box"># Add GPG key
curl -fsSL https://projects.thedude.vip/apt/silver-linings.gpg.key | \
  sudo gpg --dearmor -o /etc/apt/keyrings/silver-linings.gpg

# Add repository
echo "deb [signed-by=/etc/apt/keyrings/silver-linings.gpg] https://projects.thedude.vip/apt ./" | \
  sudo tee /etc/apt/sources.list.d/bad-ips.list

# Install
sudo apt update
sudo apt install bad-ips</div>

            <h3>2. Configure Database Connection</h3>
            <p>Edit <code>/usr/local/etc/badips.d/database.conf</code>:</p>
            <div class="install-box">[global]
db_host = 10.10.0.116
db_port = 5432
db_name = bad_ips
db_user = bad_ips_admin
db_password = your_password_here
db_ssl_mode = disable</div>

            <h3>3. Configure Network Filtering</h3>
            <p>Edit <code>/usr/local/etc/badips.conf</code>:</p>
            <div class="install-box">[global]
log_level = info
block_duration = 691200  # 8 days

# Trusted networks (never blocked)
never_block_cidrs = 10.0.0.0/8,172.16.0.0/12,192.168.0.0/16,127.0.0.0/8

# Permanent blocks (optional)
always_block_cidrs = 240.0.0.0/4,198.51.100.0/24</div>

            <h3>4. Set Up nftables</h3>
            <div class="install-box"># The installer creates /etc/nftables.d/99-badips.nft automatically
# This provides a dedicated 'inet badips' table with IPv4 and IPv6 support

# View the Bad IPs nftables configuration:
sudo cat /etc/nftables.d/99-badips.nft

# The configuration includes:
# - IPv4 sets: badipv4, never_block, always_block
# - IPv6 sets: badipv6, never_block_v6, always_block_v6
# - Prerouting hook at priority -150 (processes all traffic)

# Verify nftables configuration is loaded:
sudo nft list table inet badips</div>

            <h3>5. Start Service</h3>
            <div class="install-box">sudo systemctl enable bad_ips
sudo systemctl start bad_ips
sudo systemctl status bad_ips</div>

            <p><strong>Note:</strong> The automated installer handles all these steps, including interactive prompts for database credentials and network configuration.</p>
        </div>

        <div class="card" id="remove">
            <h2>üóëÔ∏è Uninstalling Bad IPs</h2>
            <p>To completely remove Bad IPs and clean up all configuration:</p>

            <div class="install-box">sudo apt remove --purge bad-ips</div>

            <p>This will:</p>
            <ul>
                <li>Stop and disable the bad_ips service</li>
                <li>Remove the Bad IPs package</li>
                <li>Delete the local database (<code>/var/lib/bad_ips/</code>)</li>
                <li>Clean up all nftables rules and sets</li>
            </ul>

            <h3>Expected Warnings</h3>
            <p>You may see these warnings during removal - <strong>they are normal and expected</strong>:</p>
            <div class="install-box" style="background: #2d2d2d; color: #ffa500;">dpkg: warning: while removing bad-ips, directory '/usr/local/share' not empty so not removed
dpkg: warning: while removing bad-ips, directory '/usr/local/lib' not empty so not removed
dpkg: warning: while removing bad-ips, directory '/usr/local/etc/badips.d' not empty so not removed</div>

            <p>These warnings appear because:</p>
            <ul>
                <li><code>/usr/local/share</code> and <code>/usr/local/lib</code> are system directories that may contain files from other packages</li>
                <li><code>/usr/local/etc/badips.d</code> may contain custom detector configurations you created</li>
                <li>dpkg will not remove non-empty directories to avoid deleting files from other packages or your custom configurations</li>
            </ul>

            <p><strong>Complete Cleanup:</strong> If you want to remove everything including custom configs:</p>
            <div class="install-box">sudo apt remove --purge bad-ips
sudo rm -rf /usr/local/etc/badips.d
sudo rm -rf /usr/local/etc/badips.conf</div>

            <h3>Remove Repository</h3>
            <p>To also remove the apt repository:</p>
            <div class="install-box">sudo rm /etc/apt/sources.list.d/bad-ips.list
sudo rm /etc/apt/keyrings/silver-linings.gpg
sudo apt update</div>
        </div>

        <div class="card" id="features">
            <h2>‚ú® Features</h2>
            <div class="feature-grid">
                <div class="feature">
                    <h4>üîç Real-time Monitoring</h4>
                    <p>Monitors systemd journal and log files for attack patterns</p>
                </div>
                <div class="feature">
                    <h4>üö´ Automatic Blocking</h4>
                    <p>Blocks IPs using nftables with configurable timeouts</p>
                </div>
                <div class="feature">
                    <h4>üóÑÔ∏è Centralized Database</h4>
                    <p>PostgreSQL for threat sharing across all servers</p>
                </div>
                <div class="feature">
                    <h4>‚ö° Multi-threaded</h4>
                    <p>Async architecture with queue-based pipeline</p>
                </div>
                <div class="feature">
                    <h4>üéØ Configurable Detectors</h4>
                    <p>SSH, mail, web, DNS - add your own patterns</p>
                </div>
                <div class="feature">
                    <h4>üõ°Ô∏è Trusted Networks</h4>
                    <p>Never-block CIDR filtering for management networks</p>
                </div>
            </div>

            <h3>The NATO Effect</h3>
            <div class="alert info">
                <strong>"An attack on one is an attack on all."</strong>
                <p>When any server blocks an IP, it's shared via database with all servers. An attacker brute-forcing SSH on your mail server gets instantly blocked everywhere.</p>
            </div>
        </div>

        <div class="card" id="config">
            <h2>‚öôÔ∏è Configuration</h2>
            <h3>Main Configuration</h3>
            <p>Edit <code>/usr/local/etc/badips.conf</code>:</p>
            <div class="install-box">[global]
log_level = debug
block_duration = 691200    # 8 days
never_block_cidrs = 10.0.0.0/8,172.16.0.0/12,192.168.0.0/16</div>

            <h3>Database Configuration</h3>
            <p>Edit <code>/usr/local/etc/badips.d/database.conf</code>:</p>
            <div class="install-box">[global]
db_host = 10.10.0.116
db_port = 5432
db_name = bad_ips
db_user = bad_ips_admin
db_password = your_password</div>

            <h3>Detector Configuration</h3>
            <p>Example SSH detector (<code>10-sshd.conf</code>):</p>
            <div class="install-box">[detector:sshd]
units = ssh.service, sshd.service
pattern1 = Failed password for invalid user
pattern2 = Failed password for root</div>
            <p><strong><a href="configuration.html">‚Üí Full Configuration Reference</a></strong></p>
        </div>

        <div class="card">
            <h2>üìö Documentation</h2>
            <ul>
                <li><strong>Man Page:</strong> <code>man bad_ips</code> (after installation)</li>
                <li><strong>Configuration:</strong> <a href="configuration.html">Full reference</a></li>
                <li><strong>GitHub:</strong> <a href="https://github.com/permittivity2/bad-ips">Repository</a></li>
            </ul>

            <h3>Useful Commands</h3>
            <div class="install-box">systemctl status bad_ips
systemctl reload bad_ips
journalctl -u bad_ips.service -f
sudo nft list set inet badips badipv4
sudo nft list set inet badips badipv6
sudo nft list table inet badips
bad_ips --test-config</div>
        </div>

        <div class="card" id="support">
            <h2>ü§ù Support</h2>
            <ul>
                <li><strong>Issues:</strong> <a href="https://github.com/permittivity2/bad-ips/issues">GitHub Issues</a></li>
                <li><strong>Email:</strong> gardner@homelab</li>
            </ul>
        </div>

        <div class="alert">
            <strong>‚ö†Ô∏è Security Notes:</strong>
            <ul style="margin-top:10px">
                <li>Configure <code>never_block_cidrs</code> with trusted networks</li>
                <li>Test with <code>--dry-run</code> before production</li>
                <li>Maintain backup access (console, OOB)</li>
            </ul>
        </div>
    </div>

    <footer>
        <p>Bad IPs v0.0.3 - Silver Linings, LLC</p>
        <p><a href="https://projects.thedude.vip/apt/">APT Repo</a> | <a href="https://github.com/permittivity2/bad-ips">GitHub</a></p>
    </footer>

    <script>
    function copyInstallCommand(button) {
        const command = 'bash <(curl -fsSL https://projects.thedude.vip/bad-ips/install.sh)';

        navigator.clipboard.writeText(command).then(() => {
            // Success feedback
            const originalText = button.innerHTML;
            button.innerHTML = '‚úì Copied!';
            button.classList.add('copied');

            setTimeout(() => {
                button.innerHTML = originalText;
                button.classList.remove('copied');
            }, 2000);
        }).catch(err => {
            // Fallback for older browsers
            const textArea = document.createElement('textarea');
            textArea.value = command;
            textArea.style.position = 'fixed';
            textArea.style.opacity = '0';
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);

            button.innerHTML = '‚úì Copied!';
            button.classList.add('copied');
            setTimeout(() => {
                button.innerHTML = 'üìã Copy';
                button.classList.remove('copied');
            }, 2000);
        });
    }
    </script>
</body>
</html>
